<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NLP Detective Quiz</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

      @media (orientation: portrait) {
            body::before {
                content: 'üì± Putar layar ke landscape untuk pengalaman terbaik';
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(233, 69, 96, 0.95);
                color: white;
                padding: 2rem;
                border-radius: 15px;
                z-index: 10000;
                text-align: center;
                font-size: 1.2rem;
                box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
                max-width: 80%;
            }
            
            .app-wrapper {
                filter: blur(5px);
                pointer-events: none;
            }
        }

        body {
            font-family: 'Fira Code', 'Consolas', 'Monaco', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #eee;
        }

        .app-wrapper {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            position: relative;
        }

        /* Foreign words styling */
        .foreign {
            font-style: italic;
            color: #00d4ff;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .code-rain {
            position: absolute;
            color: #00ff41;
            font-size: 14px;
            opacity: 0.3;
            animation: rain linear infinite;
        }

        @keyframes rain {
            0% {
                transform: translateY(-100%);
            }
            100% {
                transform: translateY(100%);
            }
        }

        /* Intro Screen */
        .intro-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            padding: 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .intro-logo {
            font-size: 8rem;
            margin-bottom: 2rem;
            animation: glow 2s ease-in-out infinite;
            filter: drop-shadow(0 0 20px #00ff41);
        }

        @keyframes glow {
            0%, 100% { 
                transform: scale(1);
                filter: drop-shadow(0 0 20px #00ff41);
            }
            50% { 
                transform: scale(1.1);
                filter: drop-shadow(0 0 40px #00ff41);
            }
        }

        .intro-title {
            font-size: 4rem;
            color: #00ff41;
            margin-bottom: 1.5rem;
            text-shadow: 0 0 20px #00ff41;
            animation: fadeInDown 1s ease;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .intro-description {
            font-size: 1.4rem;
            color: #e94560;
            margin-bottom: 3rem;
            max-width: 900px;
            line-height: 1.8;
            animation: fadeInUp 1s ease 0.3s backwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .intro-features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 3rem;
            max-width: 1000px;
            animation: fadeInUp 1s ease 0.6s backwards;
        }

        .feature-card {
            background: rgba(0, 255, 65, 0.1);
            border: 2px solid #00ff41;
            border-radius: 15px;
            padding: 2rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.3);
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .feature-text {
            font-size: 1.1rem;
            color: #fff;
        }

        .btn-intro {
            padding: 1.5rem 4rem;
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(135deg, #00ff41 0%, #00d4ff 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(0, 255, 65, 0.4);
            transition: all 0.3s ease;
            animation: pulse 2s ease infinite;
            font-family: 'Fira Code', monospace;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 10px 40px rgba(0, 255, 65, 0.4);
            }
            50% {
                box-shadow: 0 10px 60px rgba(0, 255, 65, 0.8);
            }
        }

        .btn-intro:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 50px rgba(0, 255, 65, 0.6);
        }

        /* Start Screen */
        .start-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            padding: 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .start-logo {
            font-size: 6rem;
            margin-bottom: 2rem;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-30px); }
        }

        .start-title {
            font-size: 3.5rem;
            color: #00ff41;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px #00ff41;
        }

        .start-subtitle {
            font-size: 1.5rem;
            color: #e94560;
            margin-bottom: 3rem;
        }

        .difficulty-selector {
            display: flex;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .difficulty-btn {
            padding: 1.5rem 3rem;
            font-size: 1.3rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #00ff41;
            border-radius: 15px;
            color: #00ff41;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Fira Code', monospace;
            position: relative;
        }

        .difficulty-btn:hover:not(.locked) {
            background: rgba(0, 255, 65, 0.2);
            transform: translateY(-5px);
        }

        .difficulty-btn.active {
            background: #00ff41;
            color: #1a1a2e;
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.5);
        }

        .difficulty-btn.locked {
            opacity: 0.3;
            cursor: not-allowed;
            border-color: #666;
            color: #666;
        }

        .difficulty-btn.locked::after {
            content: 'üîí';
            position: absolute;
            top: -15px;
            right: -15px;
            font-size: 2rem;
        }

        .btn-start {
            padding: 1.5rem 4rem;
            font-size: 1.8rem;
            font-weight: bold;
            background: linear-gradient(135deg, #00ff41 0%, #00d4ff 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 40px rgba(0, 255, 65, 0.4);
            transition: all 0.3s ease;
            font-family: 'Fira Code', monospace;
        }

        .btn-start:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0, 255, 65, 0.6);
        }

        /* Quiz Screen */
        .quiz-screen {
            display: none;
            flex-direction: column;
            min-height: 100%;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        .quiz-header {
            background: rgba(0, 255, 65, 0.1);
            border: 2px solid #00ff41;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .score-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00ff41;
            text-shadow: 0 0 10px #00ff41;
        }

        .question-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .question-counter {
            font-size: 1.3rem;
            color: #00d4ff;
        }

        .difficulty-badge {
            margin-top: 0.5rem;
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .difficulty-mudah {
            background: #00ff41;
            color: #1a1a2e;
        }

        .difficulty-sedang {
            background: #ffa500;
            color: #1a1a2e;
        }

        .difficulty-sulit {
            background: #e94560;
            color: white;
        }

        .timer-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .timer-circle {
            position: relative;
            width: 80px;
            height: 80px;
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: bold;
            color: #00ff41;
        }

        .timer-svg {
            transform: rotate(-90deg);
        }

        .question-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #00ff41;
            padding: 3rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-50px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .question-type {
            display: inline-block;
            padding: 0.7rem 1.5rem;
            background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
            color: white;
            border-radius: 25px;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            font-weight: bold;
        }

        .question-text-box {
            background: rgba(0, 255, 65, 0.1);
            padding: 2rem;
            border-radius: 12px;
            border-left: 5px solid #00ff41;
            margin-bottom: 2rem;
        }

        .question-text-box p {
            font-size: 1.5rem;
            font-style: italic;
            color: #00d4ff;
            line-height: 1.6;
        }

        .question-title {
            font-size: 2rem;
            color: #fff;
            margin-bottom: 2.5rem;
            font-weight: 600;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .options-container.single-column {
            grid-template-columns: 1fr;
        }

        .option-btn {
            padding: 2rem;
            font-size: 1.4rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid #00ff41;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            color: #fff;
            font-family: 'Fira Code', monospace;
            position: relative;
            overflow: hidden;
        }

        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .option-btn:hover::before {
            left: 100%;
        }

        .option-btn:hover {
            border-color: #00d4ff;
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.3);
        }

        .option-btn.correct {
            background: rgba(0, 255, 65, 0.3);
            border-color: #00ff41;
            animation: correctPulse 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .option-btn.incorrect {
            background: rgba(233, 69, 96, 0.3);
            border-color: #e94560;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .option-btn:disabled {
            cursor: not-allowed;
        }

        /* Time Over Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 3px solid #e94560;
            padding: 4rem;
            border-radius: 25px;
            text-align: center;
            animation: popIn 0.5s ease;
            max-width: 600px;
            box-shadow: 0 0 50px rgba(233, 69, 96, 0.5);
        }

        @keyframes popIn {
            0% {
                transform: scale(0.3) rotate(-10deg);
                opacity: 0;
            }
            70% {
                transform: scale(1.1) rotate(5deg);
            }
            100% {
                transform: scale(1) rotate(0);
                opacity: 1;
            }
        }

        .modal-icon {
            font-size: 7rem;
            margin-bottom: 1.5rem;
            animation: swing 1s ease infinite;
        }

        @keyframes swing {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }

        .modal-title {
            font-size: 3.5rem;
            color: #e94560;
            margin-bottom: 1rem;
            font-weight: bold;
            text-shadow: 0 0 20px #e94560;
        }

        .modal-message {
            font-size: 1.5rem;
            color: #00d4ff;
            margin-bottom: 2.5rem;
        }

        .btn-continue {
            padding: 1.2rem 3rem;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Fira Code', monospace;
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .btn-continue:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.6);
        }

        /* Results Screen */
        .results-screen {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100%;
            padding: 2rem;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .results-card {
            background: rgba(0, 255, 65, 0.1);
            border: 3px solid #00ff41;
            padding: 4rem;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            max-width: 900px;
            width: 100%;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.3);
        }

        .results-icon {
            font-size: 7rem;
            margin-bottom: 1.5rem;
            animation: rotate3d 2s ease infinite;
        }

        @keyframes rotate3d {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }

        .results-title {
            font-size: 3rem;
            color: #00ff41;
            margin-bottom: 2rem;
            text-shadow: 0 0 20px #00ff41;
        }

        .final-score {
            font-size: 6rem;
            font-weight: bold;
            color: #00ff41;
            margin-bottom: 1rem;
            text-shadow: 0 0 30px #00ff41;
        }

        .score-details {
            font-size: 1.5rem;
            color: #00d4ff;
            margin-bottom: 2rem;
        }

        .performance-message {
            font-size: 1.8rem;
            color: #e94560;
            margin-bottom: 2rem;
            font-weight: bold;
        }

        .reflection-box {
            background: rgba(0, 212, 255, 0.1);
            border: 2px solid #00d4ff;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2.5rem;
        }

        .reflection-box p {
            font-size: 1.2rem;
            color: #fff;
            line-height: 1.8;
        }

        .results-buttons {
            display: flex;
            gap: 2rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-secondary {
            padding: 1.2rem 3rem;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            color: #00ff41;
            border: 2px solid #00ff41;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Fira Code', monospace;
        }

        .btn-secondary:hover {
            background: rgba(0, 255, 65, 0.2);
            transform: translateY(-5px);
        }

        .btn-primary {
            padding: 1.2rem 3rem;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #00ff41 0%, #00d4ff 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Fira Code', monospace;
            box-shadow: 0 5px 20px rgba(0, 255, 65, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 65, 0.6);
        }

        .btn-next-level {
            padding: 1.2rem 3rem;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #ffa500 0%, #ff6b6b 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Fira Code', monospace;
            box-shadow: 0 5px 20px rgba(255, 165, 0, 0.4);
            animation: pulseGlow 2s ease infinite;
        }

        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 5px 20px rgba(255, 165, 0, 0.4);
            }
            50% {
                box-shadow: 0 10px 40px rgba(255, 165, 0, 0.8);
            }
        }

        .btn-next-level:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 50px rgba(255, 165, 0, 0.6);
        }

        .btn-new-game {
            padding: 1.2rem 3rem;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Fira Code', monospace;
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
        }

        .btn-new-game:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(233, 69, 96, 0.6);
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            z-index: 999;
        }

        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @media (max-width: 1024px) {
            .intro-features {
                grid-template-columns: 1fr;
            }
            
            .difficulty-selector {
                flex-direction: column;
            }
            
            .options-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="bg-animation" id="bgAnimation"></div>
  <div class="app-wrapper"><!-- Intro Screen -->
   <div class="intro-screen" id="introScreen">
    <div class="intro-logo">
     üîçüíª
    </div>
    <h1 class="intro-title" id="introTitle">Selamat Datang Detective!</h1>
    <p class="intro-description" id="introDescription">Kamu akan menyelesaikan soal dengan tingkat kesulitan berbeda tentang cara komputer memahami bahasa manusia menggunakan <span class="foreign">Natural Language Processing.</span></p>
    <div class="intro-features">
     <div class="feature-card">
      <div class="feature-icon">
       ‚è±Ô∏è
      </div>
      <div class="feature-text">
       Setiap soal memiliki batas waktu.
      </div>
     </div>
     <div class="feature-card">
      <div class="feature-icon">
       üéØ
      </div>
      <div class="feature-text">
       Soal berbeda untuk setiap pemain.
      </div>
     </div>
     <div class="feature-card">
      <div class="feature-icon">
       üìä
      </div>
      <div class="feature-text">
       3 tingkat kesulitan bertingkat.
      </div>
     </div>
    </div><button class="btn-intro" id="btnIntro">Masuk ke Arena Quiz</button>
   </div><!-- Start Screen -->
   <div class="start-screen" id="startScreen">
    <div class="start-logo">
     üîçüí¨
    </div>
    <h1 class="start-title" id="quizTitle">Tebak Cara Komputer Memahami Bahasa!</h1>
        <div class="difficulty-selector"><button class="difficulty-btn active" data-level="mudah"> üü¢ Mudah<br><small>(5 soal, 15 detik)</small> </button> <button class="difficulty-btn locked" data-level="sedang" id="btnSedang"> üü° Sedang<br><small>(5 soal, 12 detik)</small> </button> <button class="difficulty-btn locked" data-level="sulit" id="btnSulit"> üî¥ Sulit<br><small>(5 soal, 10 detik)</small> </button>
    </div><button class="btn-start" id="btnStart">Mulai Petualangan</button>
   </div><!-- Quiz Screen -->
   <div class="quiz-screen" id="quizScreen">
    <div class="quiz-header">
     <div class="score-display">
      üíé Skor: <span id="scoreValue">0</span>
     </div>
     <div class="question-info">
      <div class="question-counter" id="questionCounter">
       Soal 1/5
      </div>
      <div class="difficulty-badge" id="difficultyBadge">
       MUDAH
      </div>
     </div>
     <div class="timer-container">
      <div class="timer-circle">
       <svg class="timer-svg" width="80" height="80"><circle cx="40" cy="40" r="35" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="6" /> <circle id="timerCircle" cx="40" cy="40" r="35" fill="none" stroke="#00ff41" stroke-width="6" stroke-dasharray="220" stroke-dashoffset="0" />
       </svg>
       <div class="timer-text" id="timerText">
        15
       </div>
      </div>
     </div>
    </div>
    <div class="question-card" id="questionCard">
     <div class="question-type" id="questionType">
      Identifikasi Kata Kunci
     </div>
     <div class="question-text-box" id="textBox" style="display: none;">
      <p id="questionTextContent"></p>
     </div>
     <h2 class="question-title" id="questionTitle"></h2>
     <div class="options-container" id="optionsContainer"></div>
    </div>
   </div><!-- Time Over Modal -->
   <div class="modal-overlay" id="timeOverModal">
    <div class="modal-content">
     <div class="modal-icon">
      ‚è∞
     </div>
     <div class="modal-title">
      TIME OVER!
     </div>
     <div class="modal-message">
      Waktu habis! Mari lanjut ke soal berikutnya.
     </div><button class="btn-continue" id="btnContinue">‚ö° Lanjutkan</button>
    </div>
   </div><!-- Results Screen -->
   <div class="results-screen" id="resultsScreen">
    <div class="results-card">
     <div class="results-icon" id="resultsIcon">
      üèÜ
     </div>
     <h2 class="results-title">Misi Selesai!</h2>
     <div class="final-score" id="finalScore">
      0
     </div>
     <div class="score-details" id="scoreDetails">
      dari 100 poin
     </div>
     <div class="performance-message" id="performanceMessage">
      Detective Handal!
     </div>
     <div class="reflection-box">
      <p>üí° Komputer memproses bahasa manusia secara bertahap menggunakan <span class="foreign">NLP</span>. Sistem menganalisis kata kunci, mengenali pola kalimat, memahami konteks, dan mengklasifikasikan maksud teks untuk memberikan respons yang tepat.</p>
     </div>
     <div class="results-buttons"><button class="btn-secondary" id="btnExit">Keluar</button> <button class="btn-primary" id="btnRetry">Coba Lagi</button> <button class="btn-new-game" id="btnNewGame" style="display: none;">üîÑ Permainan Baru</button> <button class="btn-next-level" id="btnNextLevel" style="display: none;">Lanjut Level Berikutnya üöÄ</button>
     </div>
    </div>
   </div>
  </div>
  <script>
        // Audio Context for Sound Effects
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            switch(type) {
                case 'click':
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    break;
                case 'correct':
                    oscillator.type = 'sine';
                    oscillator.frequency.value = 523.25;
                    gainNode.gain.value = 0.3;
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    
                    setTimeout(() => {
                        const osc2 = audioCtx.createOscillator();
                        const gain2 = audioCtx.createGain();
                        osc2.connect(gain2);
                        gain2.connect(audioCtx.destination);
                        osc2.frequency.value = 659.25;
                        gain2.gain.value = 0.3;
                        osc2.start();
                        osc2.stop(audioCtx.currentTime + 0.1);
                    }, 100);
                    break;
                case 'incorrect':
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.value = 200;
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.3);
                    break;
                case 'timeover':
                    oscillator.type = 'square';
                    oscillator.frequency.value = 100;
                    gainNode.gain.value = 0.3;
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.5);
                    break;
                case 'complete':
                    [523.25, 587.33, 659.25, 783.99].forEach((freq, i) => {
                        setTimeout(() => {
                            const osc = audioCtx.createOscillator();
                            const gain = audioCtx.createGain();
                            osc.connect(gain);
                            gain.connect(audioCtx.destination);
                            osc.frequency.value = freq;
                            gain.gain.value = 0.2;
                            osc.start();
                            osc.stop(audioCtx.currentTime + 0.2);
                        }, i * 100);
                    });
                    break;
                case 'intro':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.5);
                    gainNode.gain.value = 0.2;
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.5);
                    break;
            }
        }

        // Config
        const defaultConfig = {
            quiz_title: "Tebak Cara Komputer Memahami Bahasa!",
            intro_title: "Selamat Datang Detective!",
            intro_description: "Kamu akan menyelesaikan soal dengan tingkat kesulitan berbeda tentang cara komputer memahami bahasa manusia menggunakan Natural Language Processing.",
            start_button: "Mulai Pertualangan",
            retry_button: "Coba Lagi",
            new_game_button: "üîÑ Permainan Baru",
            next_level_button: "Level Selanjutnya üöÄ",
            exit_button: "Keluar",
            background_color: "#1a1a2e",
            card_color: "#00ff41",
            text_color: "#ffffff",
            primary_action_color: "#00ff41",
            secondary_action_color: "#e94560",
            font_family: "Fira Code",
            font_size: 16
        };

        let currentConfig = { ...defaultConfig };

        // Level progress tracking
        let levelProgress = {
            mudah: false,
            sedang: false,
            sulit: false
        };

        // Track total score across all levels
        let totalScoreAllLevels = {
            mudah: 0,
            sedang: 0,
            sulit: 0
        };

        // Helper function to italicize foreign words
        function formatText(text, avoidHighlight = false) {
            const foreignWords = ['NLP', 'Natural Language Processing', 'tokenisasi', 'Token', 'token', 'Named Entity Recognition', 'NER', 
                                  'Part of Speech', 'POS', 'tagging', 'Intent', 'intent', 'Dependency Parsing', 'dependency parsing',
                                  'Word Embedding', 'word embedding', 'Word2Vec', 'Coreference Resolution', 'coreference resolution',
                                  'Semantic Analysis', 'semantic analysis', 'Machine Translation', 'machine translation',
                                  'transformer', 'BERT', 'GPT', 'Attention mechanism', 'attention mechanism'];
            
            // Don't highlight foreign words in answer options to avoid giving hints
            if (avoidHighlight) {
                return text;
            }
            
            let formatted = text;
            foreignWords.forEach(word => {
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                formatted = formatted.replace(regex, `<span class="foreign">${word}</span>`);
            });
            return formatted;
        }

        // Question Bank - Organized by Difficulty
        const questionBank = {
            mudah: [
                {
                    type: "Identifikasi Kata Kunci",
                    text: "Promo spesial hari ini! Diskon 50% untuk semua produk.",
                    question: "Apa kata kunci yang digunakan sistem NLP untuk mengelompokkan teks ini?",
                    options: ["Promo", "Spesial", "Produk", "Hari"],
                    correctAnswer: "Promo",
                    time: 15
                },
                {
                    type: "Klasifikasi Pola Kalimat",
                    text: "Tolong kirimkan laporan sebelum pukul 5 sore.",
                    question: "Sistem NLP mengelompokkan kalimat ini sebagai . . . .",
                    options: ["Perintah", "Pertanyaan", "Informasi", "Opini"],
                    correctAnswer: "Perintah",
                    time: 15
                },
                {
                    type: "Pengelompokan Teks",
                    text: "Cuaca hari ini sangat panas.",
                    question: "Teks ini paling tepat dikelompokkan sebagai . . . .",
                    options: ["Iklan", "Pesan pribadi", "Informasi umum", "Perintah"],
                    correctAnswer: "Informasi umum",
                    time: 15
                },
                {
                    type: "Benar / Salah",
                    text: null,
                    question: "Sistem NLP hanya membaca kata tanpa memahami makna.",
                    options: ["Benar", "Salah"],
                    correctAnswer: "Salah",
                    time: 12
                },
                {
                    type: "Identifikasi Kata Kunci",
                    text: "Mohon konfirmasi kehadiran Anda sebelum tanggal 20.",
                    question: "Kata kunci utama yang menunjukkan ini adalah permintaan adalah . . . .",
                    options: ["Mohon", "Kehadiran", "Sebelum", "Tanggal"],
                    correctAnswer: "Mohon",
                    time: 15
                },
                {
                    type: "Klasifikasi Pola Kalimat",
                    text: "Apakah Anda sudah menyelesaikan tugas tersebut?",
                    question: "Pola kalimat ini termasuk kategori . . . .",
                    options: ["Pertanyaan", "Perintah", "Pernyataan", "Saran"],
                    correctAnswer: "Pertanyaan",
                    time: 15
                },
                {
                    type: "Pengelompokan Teks",
                    text: "FLASH SALE! Gratis ongkir untuk pembelian hari ini!",
                    question: "Sistem NLP akan mengelompokkan teks ini sebagai . . . .",
                    options: ["Berita", "Iklan promosi", "Pesan pribadi", "Instruksi"],
                    correctAnswer: "Iklan promosi",
                    time: 15
                }
            ],
            sedang: [
                {
                    type: "Menentukan Makna Konteks",
                    text: "Wah, cepat sekali kamu datang!",
                    question: "Agar memahami maknanya, sistem NLP perlu memerhatikan . . . .",
                    options: ["Jumlah kata", "Panjang kalimat", "Konteks situasi", "Huruf kapital"],
                    correctAnswer: "Konteks situasi",
                    time: 12
                },
                {
                    type: "Menentukan Makna Konteks",
                    text: "Dia sangat dingin hari ini.",
                    question: "Untuk memahami apakah 'dingin' berarti suhu atau sikap, NLP perlu . . . .",
                    options: ["menghitung huruf", "menganalisis konteks", "melihat tanda baca", "menghitung kata"],
                    correctAnswer: "menganalisis konteks",
                    time: 12
                },
                {
                    type: "Analisis Sentimen",
                    text: "Produk ini mengecewakan, tidak sesuai deskripsi.",
                    question: "Sistem NLP akan mengklasifikasikan sentimen teks ini sebagai . . . .",
                    options: ["Positif", "Negatif", "Netral", "Campuran"],
                    correctAnswer: "Negatif",
                    time: 12
                },
                {
                    type: "Tokenisasi",
                    text: null,
                    question: "Tokenisasi dalam NLP adalah proses untuk . . . .",
                    options: [
                        "menerjemahkan bahasa",
                        "memecah teks menjadi unit kecil",
                        "menghitung jumlah kata",
                        "mengoreksi ejaan"
                    ],
                    correctAnswer: "memecah teks menjadi unit kecil",
                    time: 12
                },
                {
                    type: "Named Entity Recognition",
                    text: "Apple Inc. meluncurkan iPhone baru di California.",
                    question: "Sistem NER dalam NLP akan mengenali 'Apple Inc.' sebagai apa?",
                    options: ["Buah", "Nama perusahaan", "Lokasi", "Produk"],
                    correctAnswer: "Nama perusahaan",
                    time: 12
                },
                {
                    type: "Part of Speech Tagging",
                    text: "Saya belajar coding setiap hari.",
                    question: "Dalam POS tagging, kata 'belajar' termasuk kategori . . . .",
                    options: ["Kata benda", "Kata kerja", "Kata sifat", "Kata keterangan"],
                    correctAnswer: "Kata kerja",
                    time: 12
                },
                {
                    type: "Klasifikasi Intent",
                    text: "Berapa harga tiket kereta ke Bandung besok?",
                    question: "Intent (maksud) utama dari kalimat ini adalah . . . .",
                    options: ["membeli tiket", "menanyakan harga", "memesan kereta", "mencari jadwal"],
                    correctAnswer: "menanyakan harga",
                    time: 12
                }
            ],
            sulit: [
                {
                    type: "Benar / Salah",
                    text: null,
                    question: "NLP dapat memahami perbedaan kata 'bank' dalam konteks yang berbeda.",
                    options: ["Benar", "Salah"],
                    correctAnswer: "Benar",
                    time: 10
                },
                {
                    type: "Dependency Parsing",
                    text: "Mahasiswa yang rajin selalu mendapat nilai bagus.",
                    question: "Dalam dependency parsing, kata 'rajin' memodifikasi kata . . .",
                    options: ["Mahasiswa", "Selalu", "Mendapat", "Nilai"],
                    correctAnswer: "Mahasiswa",
                    time: 10
                },
                {
                    type: "Word Embedding",
                    text: null,
                    question: "Word embedding berfungsi untuk . . . .",
                    options: [
                        "menghitung frekuensi kata",
                        "mengubah kata menjadi vektor numerik",
                        "mengoreksi grammar",
                        "menghapus stopwords"
                    ],
                    correctAnswer: "mengubah kata menjadi vektor numerik",
                    time: 10
                },
                {
                    type: "Coreference Resolution",
                    text: "Maria membeli buku. Dia sangat menyukainya.",
                    question: "Dalam coreference resolution, kata 'Dia' merujuk pada . . . .",
                    options: ["Buku", "Maria", "Penjual", "Toko"],
                    correctAnswer: "Maria",
                    time: 10
                },
                {
                    type: "Semantic Analysis",
                    text: "'Kick the bucket' dalam bahasa Inggris.",
                    question: "NLP perlu semantic analysis untuk memahami frasa idiom ini berarti . . . .",
                    options: ["menendang ember", "meninggal dunia", "bermain bola", "membersihkan"],
                    correctAnswer: "meninggal dunia",
                    time: 10
                },
                {
                    type: "Machine Translation Challenge",
                    text: null,
                    question: "Apa tantangan terbesar dalam machine translation NLP?",
                    options: [
                        "Kecepatan internet",
                        "Memahami idiom dan budaya",
                        "Ukuran kamus",
                        "Warna teks"
                    ],
                    correctAnswer: "Memahami idiom dan budaya",
                    time: 10
                },
                {
                    type: "Advanced NLP",
                    text: null,
                    question: "Model transformer menggunakan mekanisme apa untuk memahami konteks?",
                    options: [
                        "Recurrent loops",
                        "Attention mechanism",
                        "Decision trees",
                        "Linear regression"
                    ],
                    correctAnswer: "Attention mechanism",
                    time: 10
                }
            ]
        };

        let selectedDifficulty = 'mudah';
        let currentQuestions = [];
        let currentQuestion = 0;
        let score = 0;
        let timer;
        let timeLeft;
        let answered = false;
        let correctCount = 0;
        let incorrectCount = 0;

        const introScreen = document.getElementById('introScreen');
        const startScreen = document.getElementById('startScreen');
        const quizScreen = document.getElementById('quizScreen');
        const resultsScreen = document.getElementById('resultsScreen');
        const timeOverModal = document.getElementById('timeOverModal');

        // Initialize background animation
        function createBackgroundAnimation() {
            const bg = document.getElementById('bgAnimation');
            const chars = '01';
            
            for (let i = 0; i < 20; i++) {
                const rain = document.createElement('div');
                rain.className = 'code-rain';
                rain.style.left = Math.random() * 100 + '%';
                rain.style.animationDuration = (Math.random() * 3 + 2) + 's';
                rain.style.animationDelay = Math.random() * 2 + 's';
                rain.textContent = chars[Math.floor(Math.random() * chars.length)].repeat(20);
                bg.appendChild(rain);
            }
        }

        createBackgroundAnimation();

        // Shuffle array function
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Config functions
        function applyConfig(config) {
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const baseFontStack = 'Consolas, Monaco, monospace';
            
            document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
            
            document.getElementById('introTitle').textContent = config.intro_title || defaultConfig.intro_title;
            const introDesc = document.getElementById('introDescription');
            introDesc.innerHTML = formatText(config.intro_description || defaultConfig.intro_description);
            
            document.getElementById('quizTitle').textContent = config.quiz_title || defaultConfig.quiz_title;
            document.getElementById('quizSubtitle').textContent = config.quiz_subtitle || defaultConfig.quiz_subtitle;
            document.getElementById('btnStart').textContent = config.start_button || defaultConfig.start_button;
            document.getElementById('btnRetry').textContent = config.retry_button || defaultConfig.retry_button;
            document.getElementById('btnNewGame').textContent = config.new_game_button || defaultConfig.new_game_button;
            document.getElementById('btnNextLevel').textContent = config.next_level_button || defaultConfig.next_level_button;
            document.getElementById('btnExit').textContent = config.exit_button || defaultConfig.exit_button;
        }

        async function onConfigChange(config) {
            currentConfig = { ...config };
            applyConfig(config);
        }

        // Update difficulty button states
        function updateDifficultyButtons() {
            const btnSedang = document.querySelector('[data-level="sedang"]');
            const btnSulit = document.getElementById('btnSulit');
            
            if (levelProgress.mudah) {
                btnSedang.classList.remove('locked');
            }
            
            if (levelProgress.sedang) {
                btnSulit.classList.remove('locked');
            }
        }

        // Intro screen
        document.getElementById('btnIntro').addEventListener('click', () => {
            playSound('intro');
            introScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        });

        // Difficulty selection
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.classList.contains('locked')) {
                    playSound('incorrect');
                    return;
                }
                
                playSound('click');
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedDifficulty = btn.dataset.level;
            });
        });

        // Start quiz
        document.getElementById('btnStart').addEventListener('click', () => {
            playSound('click');
            startQuiz();
        });

        function startQuiz() {
            // Generate unique random question set for each player
            const allQuestions = shuffleArray([...questionBank[selectedDifficulty]]).slice(0, 5);
            
            // Store correct answers and shuffle options
            currentQuestions = allQuestions.map(q => {
                const correctAnswer = q.correctAnswer;
                const shuffledOptions = shuffleArray([...q.options]);
                const newCorrectIndex = shuffledOptions.indexOf(correctAnswer);
                
                return {
                    ...q,
                    options: shuffledOptions,
                    correct: newCorrectIndex
                };
            });
            
            currentQuestion = 0;
            score = 0;
            correctCount = 0;
            incorrectCount = 0;
            
            startScreen.style.display = 'none';
            quizScreen.style.display = 'flex';
            resultsScreen.style.display = 'none';
            
            loadQuestion();
        }

        function loadQuestion() {
            if (currentQuestion >= currentQuestions.length) {
                showResults();
                return;
            }

            answered = false;
            const q = currentQuestions[currentQuestion];
            
            document.getElementById('questionCounter').textContent = `Soal ${currentQuestion + 1}/${currentQuestions.length}`;
            document.getElementById('scoreValue').textContent = score;
            document.getElementById('questionType').innerHTML = formatText(q.type);
            
            const badge = document.getElementById('difficultyBadge');
            badge.textContent = selectedDifficulty.toUpperCase();
            badge.className = 'difficulty-badge difficulty-' + selectedDifficulty;
            
            if (q.text) {
                document.getElementById('textBox').style.display = 'block';
                document.getElementById('questionTextContent').innerHTML = formatText(`"${q.text}"`);
            } else {
                document.getElementById('textBox').style.display = 'none';
            }
            
            document.getElementById('questionTitle').innerHTML = formatText(q.question);
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            if (q.options.length === 2) {
                optionsContainer.classList.add('single-column');
            } else {
                optionsContainer.classList.remove('single-column');
            }
            
            q.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = formatText(option, true); // Don't highlight foreign words in options
                btn.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(btn);
            });
            
            startTimer(q.time);
        }

        function startTimer(duration) {
            timeLeft = duration;
            document.getElementById('timerText').textContent = timeLeft;
            
            const circumference = 220;
            const timerCircle = document.getElementById('timerCircle');
            
            clearInterval(timer);
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timerText').textContent = timeLeft;
                
                const offset = circumference - (timeLeft / duration) * circumference;
                timerCircle.style.strokeDashoffset = offset;
                
                if (timeLeft <= 3 && timeLeft > 0) {
                    playSound('click');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    if (!answered) {
                        handleTimeOver();
                    }
                }
            }, 1000);
        }

        function selectAnswer(index) {
            if (answered) return;
            
            answered = true;
            clearInterval(timer);
            
            const q = currentQuestions[currentQuestion];
            const buttons = document.querySelectorAll('.option-btn');
            
            buttons.forEach(btn => btn.disabled = true);
            
            if (index === q.correct) {
                buttons[index].classList.add('correct');
                playSound('correct');
                
                let points = 20;
                score += points;
                correctCount++;
                document.getElementById('scoreValue').textContent = score;
                createConfetti();
            } else {
                buttons[index].classList.add('incorrect');
                buttons[q.correct].classList.add('correct');
                playSound('incorrect');
                incorrectCount++;
            }
            
            setTimeout(() => {
                currentQuestion++;
                loadQuestion();
            }, 2000);
        }

        function handleTimeOver() {
            playSound('timeover');
            incorrectCount++;
            timeOverModal.style.display = 'flex';
        }

        document.getElementById('btnContinue').addEventListener('click', () => {
            playSound('click');
            timeOverModal.style.display = 'none';
            currentQuestion++;
            loadQuestion();
        });

        function showResults() {
            playSound('complete');
            quizScreen.style.display = 'none';
            resultsScreen.style.display = 'flex';
            
            // Save score for current level
            totalScoreAllLevels[selectedDifficulty] = score;
            
            const maxScore = 100;
            const percentage = score;
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('scoreDetails').textContent = `dari ${maxScore} poin (${correctCount} benar, ${incorrectCount} salah)`;
            
            const performanceMsg = document.getElementById('performanceMessage');
            const resultsIcon = document.getElementById('resultsIcon');
            const btnNextLevel = document.getElementById('btnNextLevel');
            const btnNewGame = document.getElementById('btnNewGame');
            
            // Reset buttons
            btnNextLevel.style.display = 'none';
            btnNewGame.style.display = 'none';
            
            // Remove any previous score breakdown
            const existingBreakdown = document.querySelector('.results-card .reflection-box').previousElementSibling;
            if (existingBreakdown && existingBreakdown.innerHTML.includes('Rincian Skor')) {
                existingBreakdown.remove();
            }
            
            if (percentage >= 90) {
                performanceMsg.textContent = 'üåü Detective Master! Sempurna!';
                resultsIcon.textContent = 'üèÜ';
                createConfetti();
            } else if (percentage >= 75) {
                performanceMsg.textContent = '‚≠ê Detective Handal!';
                resultsIcon.textContent = 'üéâ';
            } else if (percentage >= 60) {
                performanceMsg.textContent = 'üëç Detective yang Baik!';
                resultsIcon.textContent = 'üéØ';
            } else {
                performanceMsg.textContent = 'üí™ Terus Berlatih, Detective!';
                resultsIcon.textContent = 'üìö';
            }
            
            // Check if this is the final level (sulit)
            if (selectedDifficulty === 'sulit') {
                levelProgress.sulit = true;
                
                // Calculate average score (skala 100)
                const averageScore = Math.round((totalScoreAllLevels.mudah + totalScoreAllLevels.sedang + totalScoreAllLevels.sulit) / 3);
                const maxTotalScore = 100;
                
                // Update display to show average score
                document.getElementById('finalScore').textContent = averageScore;
                document.getElementById('scoreDetails').textContent = `dari ${maxTotalScore} poin (rata-rata dari 3 level)`;
                
                // Add breakdown of scores per level
                const reflectionBox = document.querySelector('.reflection-box');
                const scoreBreakdown = document.createElement('div');
                scoreBreakdown.style.marginTop = '1.5rem';
                scoreBreakdown.style.padding = '1.5rem';
                scoreBreakdown.style.background = 'rgba(0, 255, 65, 0.1)';
                scoreBreakdown.style.borderRadius = '10px';
                scoreBreakdown.style.border = '2px solid #00ff41';
                scoreBreakdown.innerHTML = `
                    <h3 style="color: #00ff41; font-size: 1.5rem; margin-bottom: 1rem;">üìä Rincian Skor Per Level:</h3>
                    <div style="display: flex; justify-content: space-around; margin-bottom: 1rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem; color: #00ff41; font-weight: bold;">${totalScoreAllLevels.mudah}</div>
                            <div style="color: #fff; font-size: 1.1rem;">üü¢ Mudah</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem; color: #ffa500; font-weight: bold;">${totalScoreAllLevels.sedang}</div>
                            <div style="color: #fff; font-size: 1.1rem;">üü° Sedang</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2.5rem; color: #e94560; font-weight: bold;">${totalScoreAllLevels.sulit}</div>
                            <div style="color: #fff; font-size: 1.1rem;">üî¥ Sulit</div>
                        </div>
                    </div>
                    <div style="text-align: center; font-size: 1.3rem; color: #00d4ff; font-weight: bold;">
                        üéØ Skor Akhir: ${averageScore} / ${maxTotalScore} poin
                    </div>
                `;
                
                // Insert before the reflection text
                reflectionBox.parentNode.insertBefore(scoreBreakdown, reflectionBox);
                
                // Update performance message based on average score
                if (averageScore >= 90) {
                    performanceMsg.textContent = 'üëë GRAND MASTER DETECTIVE! Luar Biasa!';
                    resultsIcon.textContent = 'üèÜ';
                    createConfetti();
                } else if (averageScore >= 80) {
                    performanceMsg.textContent = 'üåü EXPERT DETECTIVE! Sangat Hebat!';
                    resultsIcon.textContent = '‚≠ê';
                } else if (averageScore >= 70) {
                    performanceMsg.textContent = 'üéØ SKILLED DETECTIVE! Kerja Bagus!';
                    resultsIcon.textContent = 'üéâ';
                } else {
                    performanceMsg.textContent = 'üí™ BRAVE DETECTIVE! Terus Tingkatkan!';
                    resultsIcon.textContent = 'üî•';
                }
                
                // Show "Permainan Baru" button after completing all levels
                btnNewGame.style.display = 'inline-block';
            }
            // Always show next level button after completing mudah or sedang
            else if (selectedDifficulty === 'mudah') {
                levelProgress.mudah = true;
                updateDifficultyButtons();
                btnNextLevel.style.display = 'inline-block';
                btnNextLevel.onclick = () => {
                    playSound('click');
                    selectedDifficulty = 'sedang';
                    // Update active difficulty button
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    document.querySelector('[data-level="sedang"]').classList.add('active');
                    resultsScreen.style.display = 'none';
                    startQuiz();
                };
            } else if (selectedDifficulty === 'sedang') {
                levelProgress.sedang = true;
                updateDifficultyButtons();
                btnNextLevel.style.display = 'inline-block';
                btnNextLevel.onclick = () => {
                    playSound('click');
                    selectedDifficulty = 'sulit';
                    // Update active difficulty button
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    document.getElementById('btnSulit').classList.add('active');
                    resultsScreen.style.display = 'none';
                    startQuiz();
                };
            }
        }

        function createConfetti() {
            const colors = ['#00ff41', '#00d4ff', '#e94560', '#ffa500', '#ff6b6b'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-10px';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animation = `confetti-fall ${Math.random() * 3 + 2}s linear`;
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 5000);
            }
        }

        document.getElementById('btnRetry').addEventListener('click', () => {
            playSound('click');
            resultsScreen.style.display = 'none';
            startScreen.style.display = 'flex';
        });

        document.getElementById('btnNewGame').addEventListener('click', () => {
            playSound('click');
            // Reset all progress
            levelProgress = {
                mudah: false,
                sedang: false,
                sulit: false
            };
            totalScoreAllLevels = {
                mudah: 0,
                sedang: 0,
                sulit: 0
            };
            selectedDifficulty = 'mudah';
            
            // Reset difficulty buttons
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.level !== 'mudah') {
                    btn.classList.add('locked');
                }
            });
            document.querySelector('[data-level="mudah"]').classList.add('active');
            
            // Return to intro screen
            resultsScreen.style.display = 'none';
            introScreen.style.display = 'flex';
        });

        document.getElementById('btnExit').addEventListener('click', () => {
            playSound('click');
            resultsScreen.style.display = 'none';
            introScreen.style.display = 'flex';
        });

        // Initialize SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["quiz_title", config.quiz_title || defaultConfig.quiz_title],
                    ["quiz_subtitle", config.quiz_subtitle || defaultConfig.quiz_subtitle],
                    ["intro_title", config.intro_title || defaultConfig.intro_title],
                    ["intro_description", config.intro_description || defaultConfig.intro_description],
                    ["start_button", config.start_button || defaultConfig.start_button],
                    ["retry_button", config.retry_button || defaultConfig.retry_button],
                    ["new_game_button", config.new_game_button || defaultConfig.new_game_button],
                    ["next_level_button", config.next_level_button || defaultConfig.next_level_button],
                    ["exit_button", config.exit_button || defaultConfig.exit_button]
                ])
            });
        }

        applyConfig(defaultConfig);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b98444f66fbe9d5',t:'MTc2NzY3MTU5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
